{% extends '../base.html' %}

{% block content %}
{% load static %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/flexslider/2.6.3/jquery.flexslider-min.js"></script>
<script type="text/javascript">
    $(document).ready(function() { 
        var status = {{ arequest.progress }}
        var active_circle= $('.label:contains(' + status + ')').parent()
        active_circle.removeClass('circle').addClass('circle active'); 

        var label = $('.label')
        var circles = label.parent()
        console.log(circles)

        circles.each(function(){
            if ($(this).find(".label").text() < status){
                //console.log($(this).find("span").text())
                $(this).removeClass('circle').addClass('circle done'); 
            }
        })
    });

    $(document).ready(function() { 
        const active_menu = $('#requests')
        active_menu.removeClass('sidenav--menu_sub').addClass('sidenav--menu_sub-active'); 
    });
    $(document).ready(function() {
    $('.flexslider').flexslider({
      animation: "slide"
      
    });
});

</script>
<script>
    function confirmDelete() {
        swal({
            title: "Are you sure?",
            text: "Once deleted, you will not be able to recover this request",
            icon: "warning",
            buttons:{ text: "Confirm", cancel: "Cancel"},
            dangerMode: true,
            })
            .then((willDelete) => {
            if (willDelete) {
                swal("This request has been deleted!", {
                icon: "success",
                }).then(()=>{window.location.href = '/adminpage/{{arequest.id}}/delete'});
            } else {
                swal("Your request is safe!");
            }
        });
    }
</script>

{% now "Y/m/d" as todays_date %}

<div class="eachRequest">

    <div class = "eachRequest--request" >
            <div stlye = "display: flex;"> 
                    <div class= "eachRequest--request--btnwrapper">
                            <a class="eachRequest--editbtn" href='/adminpage/{{arequest.id}}/edit'>
                                Edit
                            </a>
                            <a 
                                class="eachRequest--deletebtn" 
                                onclick=confirmDelete()
                            >
                                Delete
                            </a>
                    </div>
                        
                            
                    <div class="eachRequest--header">
                        <p1>Request # {{arequest.id}}</p1>
                        <div class="eachRequest--status">
                            <p2 class="status">Status: {{ arequest.progress }}</p2>
                            {% if arequest.progress == 5 %}
                            <p2 class="complete"> COMPLETE </p2>
                            {% elif todays_date > arequest.due_at|date:'Y/m/d'%}
                            <p2 class="overdate"> OVERDATE </p2>
                            {% endif %}
                        </div>
                    </div>

            </div>
            
            
            
                <div class="progress">
            
                        <div class="circle">
                            <span class="label">1</span>
                            <span class="title">0%</span>
                        </div>
            
                        <span class="bar"></span>
                        <div class="circle">
                            <span class="label">2</span>
                            <span class="title">25%</span>
                        </div>
            
                        <span class="bar"></span>
                        <div class="circle">
                            <span class="label">3</span>
                            <span class="title">50%</span>
                        </div>
            
                        <span class="bar"></span>
                        <div class="circle">
                            <span class="label">4</span>
                            <span class="title">75%</span>
                        </div>
            
                        <span class="bar"></span>
                        <div class="circle">
                            <span class="label">5</span>
                            <span class="title">100%</span>
                        </div>
                </div>
                <div>
                        <div style="display: flex;">
                                <div class="eachRequest--plan">
                                        <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Uploaded Plan Image</label>
                                        <div class="flexslider">
                                            <ul class="slides">
                                                {% for plan in arequest.floor_plan.all %}
                                                <li>
                                                    <img class="eachRequest--plan_img" src="{{ plan.photo.url }}">
                                                    <a class="eachRequest--plan_btn" style = "text-decoration: none;" href= "/{{arequest.id}}/{{plan.id}}/download" >
                                                        <i class="fas fa-file-download"></i> Press to Download
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                
                                        </div>  
                                    </div>
                                    <div class="eachRequest--info">
                                
                                            <div class="eachRequest--info_num">
                                                <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Floor Type :</label>
                                                <hr class="line"/>
                                                <div class="floor_info">
                                                    {% if arequest.floor_type == "Residential" %}
                                                        {{arequest.floor_type}}
                                                    {% else %}
                                                        {{arequest.floor_type}} ( {{arequest.commercial_type}} )
                                                    {% endif %}
                    
                                                </div>
                                                
                                                
                                            </div>
                                    
                                            <div class="eachRequest--info_num">
                                                <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Floor Size:</label>
                                                <hr class="line"/>
                                                <div class="floor_info">
                                                    {{arequest.floor_size}} {{arequest.floor_size_unit}} <sup>2</sup>
                                                </div>
                                                
                                            </div>
                                    
                                            <div class="eachRequest--info_num">
                                                <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Floor Number:</label>
                                                <hr class="line"/>
                                                <div class="floor_info">
                                                    {{arequest.floor_number}} 
                                                </div>
                                                
                                            </div>
                                    
                                            <!-- Optional Tags -->
                                    
                                            {% if arequest.floor_address != "" %}
                                                <div class="eachRequest--info_num">
                                                    <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Floor Address:</label>
                                                    <hr class="line"/>
                                                    <div class="floor_info">{{arequest.floor_address}} </div>
                                                </div>
                                            {% endif %}
                                    
                                            <!-- Optional Tags -->
                                    
                                            {% if arequest.floor_height != "" %}
                                                <div class="eachRequest--info_num">
                                                    <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Floor Height:</label>
                                                    <hr class="line"/>
                                                    <div class="floor_info">
                                                        {{arequest.floor_height}} {{arequest.floor_height_unit}} 
                                                    </div>
                                                </div>
                                            {% endif %}
                                    
                                            {% if arequest.add_request != "" %}
                                                <div class="eachRequest--info_num">
                                                    <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Additional Requests:</label>
                                                    <hr class="line"/>
                                                    <div class="floor_info">{{arequest.add_request}}</div>
                                                </div>
                                            {% endif %}
                                    </div>
                                
                        </div>
                        
                    
                    
                        <!-- selected theme -->
                        {% if arequest.selected_theme.all  %}
                        <div class="eachRequest--stheme">
                            <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Selected Theme Preferences</label>
                            <div class="eachRequest--stheme_wrapper" >
                                {% for theme in arequest.selected_theme.all %}
                                    <img class="eachRequest--stheme_img" src="{{ theme.option }}">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    
                        <!-- uploaded theme -->
                        {% if arequest.uploaded_theme.all  %}
                        <div class="eachRequest--utheme">
                            <label><i class="far fa-check-circle" style="margin-right: 5px"></i>Uploaded Theme Preferences</label>
                            <div class="eachRequest--utheme_wrapper" >
                                {% for theme in arequest.uploaded_theme.all %}
                                    
                                    <img class="eachRequest--utheme_img"src="{{ theme.photo.url }}">
                                    
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
            
                </div>

    </div>
    

    
    <div class = "eachRequest--chatroom">

        <div class = "eachRequest--chatroom_header">
            <div style="text-align: center; margin-top: 10px; font-weight: 100;">{{arequest.username}}</div>
            <hr style="margin-top: 10px; opacity: 20%;"/>
        </div>

        <div class = "eachRequest--chatroom_msg">
            
            {% if message_list %}
            <div>
                {% for msg in message_list %}
                    {% if msg.sender == 'admin' %}
                    <div class="msg_me">
                        <div>
                            <p1>{{msg.content}}</p1>
                            <p2 style="float:right; font-size: 11px; color:rgba(255, 255, 255, 0.685);">{{msg.timestamp|timesince}} 전</p2>
                        </div>
                    </div>
                    {% else %}
                    <div style="display:flex;">
                        <div><img style="width:40px; height:40px" src="{% static 'profile_pic.png' %}"/></div>
                        <div class="msg_client">
                            <div>
                                <p1>{{msg.content}}</p1>
                                <p2 style="float:right; font-size: 11px; color:rgb(185, 185, 185);">{{msg.timestamp|timesince}} 전</p2>
                            </div>
                        </div>

                    </div>
                    
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}

        </div>

        <div class = "eachRequest--chatroom_send"> 
            <form style="display: flex; padding: 20px; height: 100%;" action="/adminpage/{{ arequest.id }}/" method="POST">
                {% csrf_token %}
                <textarea class="input" placeholder= "Enter your message" name="msg_content"></textarea>
                <input class="submit" type="submit" value="Send"/>
            </form>
        </div>
        
    </div>

      
    
    

</div>
{% endblock content %}